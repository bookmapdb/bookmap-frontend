<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookMap — 도서 리스트</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; background: #fafafa; }
    h1 { font-size: 22px; margin-bottom: 16px; }
    .filters { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
    select, button {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: white;
      cursor: pointer;
    }
    table { border-collapse: collapse; width: 100%; max-width: 900px; background: white; }
    th, td {
      border: 1px solid #ddd; padding: 8px; text-align: left;
    }
    th { background: #f3f4f6; }
  </style>
</head>
<body>
  <h1>승인된 도서 리스트</h1>

  <!-- 🔎 필터 영역 -->
  <div class="filters">
    <label>
      카테고리:
      <select id="categoryFilter">
        <option value="">전체</option>
        <option value="기독교">기독교</option>
        <option value="신학">신학</option>
        <option value="역사">역사</option>
        <option value="철학">철학</option>
        <option value="문학">문학</option>
      </select>
    </label>
    <label>
      레벨:
      <select id="levelFilter">
        <option value="">전체</option>
        <option value="입문">입문</option>
        <option value="초급">초급</option>
        <option value="중급">중급</option>
        <option value="고급">고급</option>
        <option value="전문">전문</option>
      </select>
    </label>
    <button onclick="applyFilter()">필터 적용</button>
    <button onclick="resetFilter()">초기화</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>제목</th>
        <th>저자</th>
        <th>출판사</th>
        <th>카테고리</th>
        <th>레벨</th>
      </tr>
    </thead>
    <tbody id="bookList"></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbygL5W_rVDTMkPIjLiSjDVN5nxRaZgHTIW3vbJgTgOL_Z_IwLF4k97VEd1bQNfxqAs1_A/exec";
    let allBooks = [];

    async function loadBooks() {
      try {
        const res = await fetch(API_URL + "?action=list");
        allBooks = await res.json();
        renderBooks(allBooks);
      } catch (err) {
        alert("❌ 도서 목록 불러오기 실패");
      }
    }

    function renderBooks(books) {
      const tbody = document.getElementById("bookList");
      tbody.innerHTML = "";
      if (books.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5">📭 검색 결과가 없습니다.</td></tr>`;
        return;
      }
      books.forEach(book => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${book["제목"] || ""}</td>
          <td>${book["저자"] || ""}</td>
          <td>${book["출판사"] || ""}</td>
          <td>${book["카테고리"] || "-"}</td>
          <td>${book["레벨"] || "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function applyFilter() {
      const category = document.getElementById("categoryFilter").value;
      const level = document.getElementById("levelFilter").value;

      const filtered = allBooks.filter(book => {
        return (category === "" || book["카테고리"] === category) &&
               (level === "" || book["레벨"] === level);
      });

      renderBooks(filtered);
    }

    function resetFilter() {
      document.getElementById("categoryFilter").value = "";
      document.getElementById("levelFilter").value = "";
      renderBooks(allBooks);
    }

    loadBooks();
  </script>
</body>
</html>
