<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookMap â€” ë„ì„œ ë¦¬ìŠ¤íŠ¸</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; background: #fafafa; }
    h1 { font-size: 22px; margin-bottom: 16px; }
    .filters { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
    select, button {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: white;
      cursor: pointer;
    }
    table { border-collapse: collapse; width: 100%; max-width: 900px; background: white; }
    th, td {
      border: 1px solid #ddd; padding: 8px; text-align: left;
    }
    th { background: #f3f4f6; }
  </style>
</head>
<body>
  <h1>ìŠ¹ì¸ëœ ë„ì„œ ë¦¬ìŠ¤íŠ¸</h1>

  <!-- ğŸ” í•„í„° ì˜ì—­ -->
  <div class="filters">
    <label>
      ì¹´í…Œê³ ë¦¬:
      <select id="categoryFilter">
        <option value="">ì „ì²´</option>
        <option value="ê¸°ë…êµ">ê¸°ë…êµ</option>
        <option value="ì‹ í•™">ì‹ í•™</option>
        <option value="ì—­ì‚¬">ì—­ì‚¬</option>
        <option value="ì² í•™">ì² í•™</option>
        <option value="ë¬¸í•™">ë¬¸í•™</option>
      </select>
    </label>
    <label>
      ë ˆë²¨:
      <select id="levelFilter">
        <option value="">ì „ì²´</option>
        <option value="ì…ë¬¸">ì…ë¬¸</option>
        <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
        <option value="ì¤‘ê¸‰">ì¤‘ê¸‰</option>
        <option value="ê³ ê¸‰">ê³ ê¸‰</option>
        <option value="ì „ë¬¸">ì „ë¬¸</option>
      </select>
    </label>
    <button onclick="applyFilter()">í•„í„° ì ìš©</button>
    <button onclick="resetFilter()">ì´ˆê¸°í™”</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>ì œëª©</th>
        <th>ì €ì</th>
        <th>ì¶œíŒì‚¬</th>
        <th>ì¹´í…Œê³ ë¦¬</th>
        <th>ë ˆë²¨</th>
      </tr>
    </thead>
    <tbody id="bookList"></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbygL5W_rVDTMkPIjLiSjDVN5nxRaZgHTIW3vbJgTgOL_Z_IwLF4k97VEd1bQNfxqAs1_A/exec";
    let allBooks = [];

    async function loadBooks() {
      try {
        const res = await fetch(API_URL + "?action=list");
        allBooks = await res.json();
        renderBooks(allBooks);
      } catch (err) {
        alert("âŒ ë„ì„œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
      }
    }

    function renderBooks(books) {
      const tbody = document.getElementById("bookList");
      tbody.innerHTML = "";
      if (books.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5">ğŸ“­ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }
      books.forEach(book => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${book["ì œëª©"] || ""}</td>
          <td>${book["ì €ì"] || ""}</td>
          <td>${book["ì¶œíŒì‚¬"] || ""}</td>
          <td>${book["ì¹´í…Œê³ ë¦¬"] || "-"}</td>
          <td>${book["ë ˆë²¨"] || "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function applyFilter() {
      const category = document.getElementById("categoryFilter").value;
      const level = document.getElementById("levelFilter").value;

      const filtered = allBooks.filter(book => {
        return (category === "" || book["ì¹´í…Œê³ ë¦¬"] === category) &&
               (level === "" || book["ë ˆë²¨"] === level);
      });

      renderBooks(filtered);
    }

    function resetFilter() {
      document.getElementById("categoryFilter").value = "";
      document.getElementById("levelFilter").value = "";
      renderBooks(allBooks);
    }

    loadBooks();
  </script>
</body>
</html>
